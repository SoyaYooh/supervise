<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>项目信息</title>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../js/layer/theme/default/layer.css"/>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-select.min.css"/>
    <script type="text/javascript" src="../js/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="../js/bootstrap/bootstrap.js"></script>
    <script type="text/javascript" src="../js/bootstrap/bootstrap-select.js"></script>
    <script type="text/javascript" src="../js/layer/layer.js"></script>
    <style>
        .mytable_button_div {
            text-align: right;
            padding-right: 10px;
            padding-top: 4px;
            padding-bottom: 4px;
        }

        .mytable_button {
            padding: 0;
            margin: 0;
            height: 18px;
        }

        .mytable_button li {
            list-style: none;
            margin-left: 20px;
            float: right;
            width: 70px;
            border-left: 1px solid #EEF3FB;
            cursor: pointer;
        }

        .form_pro {
            font-size: 14px;
            color: rgb(51, 51, 51);
            border-collapse: collapse;
            width: 100%;
            border-color: rgb(200, 199, 204);
            margin: 0px;
        }

        /*新表格样式*/
        .new_tab {
            border-collapse: collapse;

        }

        .new_tab thead tr td {
            background-image: url(../images/new_tab_img.png);
            border: 1px solid #BED5F3;
        }

        .new_tab tr td {
            border: 1px solid #BED5F3;
            color: #565656;
        }

        .new_tab tr:hover {
            background: #bceee3;
        }

        .ftable thead tr td {
            font: bold 13px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
            color: #ffffff;
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
            border-top: 1px solid #ffffff;
            letter-spacing: 2px;
            /* text-transform: uppercase; */
            text-align: center;
            padding: 6px 6px 6px 12px;
            background: rgb(0, 150, 135);
        }

        .ftable tr td {
            border-right: 1px solid #C1DAD7;
            border-bottom: 1px solid #C1DAD7;
            font-size: 13px;
            padding: 6px 6px 6px 12px;
            text-align: center;
        }

        .ftr1 {
            background: #fff;
            color: #797268;
        }

        .ftr2 {
            background: #e9fffa;
            color: #4f6b72;
        }

        /*鼠标移上变换底色*/
        .ftr3 {
            background: #bceee3;
        }

        .fixed {
            position: fixed;
            width: auto;
            z-index: 2;
            border: none;
        }

        .ftable {
            width: 100%;
        }

        .new_tab {
            border-collapse: collapse;
        }
    </style>
<body>
<div class="container-fluid">
    <div style="height: 10px"></div>
    <div class="hero-unit">
        <div>
            <form class="form-search" style="margin-bottom: 0;">
                <table class="form_pro">
                    <tr>
                        <th class="form_head">数据库类型：</th>
                        <td class="input-prepend input-append">
                            <select class="input-block-level" name="dataSourceType" id="dataSourceType">
                                <option value="Oracle">==请选择==</option>
                                <option value="Oracle">Oracle</option>
                                <option value="Mysql">Mysql</option>
                                <option value="SqlServer">SqlServer</option>
                            </select>
                            <span class="add-on iconfont icon-fenggepeizhi"></span>
                        </td>
                    </tr>
                    <tr>
                        <th class="form_head">数据库url：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="url">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">用户名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="userName">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">密码：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="passWord">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">表名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="tableName" value="">
                            <span class="add-on iconfont icon-biaoge"></span>
                        </td>
                    </tr>
                    <tr>
                        <!--         <th class="form_head">开发框架：</th>
                                 <td class="">
                                     <select class="input-block-level" name="frameType">
                                         <option value="standard">标准结构</option>
                                         <option value="tree">树结构</option>
                                         <option value="original" selected>原始结构</option>
                                     </select>
                                  <span class="add-on iconfont icon-mn_kuangjia_fill"></span>
                                 </td>
         -->

                        <th class="form_head">包名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="packageName">
                            <span class="add-on iconfont icon-caidan"></span>
                        </td>
                        <th class="form_head">持久层框架：</th>
                        <td class="input-prepend input-append">
                            <select class="input-block-level" id="ormType" name="ormType">
                                <option value="Mybatis">==请选择==</option>
                                <option value="Mybatis">Mybatis</option>
                                <option value="Mybatis-plus">Mybatis-plus</option>
                                <option value="Jpa">Jpa</option>
                            </select>
                            <span class="add-on iconfont icon-fenggepeizhi"></span>
                        </td>
                        <th class="form_head">方法：</th>
                        <td class="">
                            <select id="select" name="select" class="selectpicker input-block-level" multiple
                                    data-live-search="true" data-actions-box="true">　　
                                <option value="mvc">MVC</option>
                                　　
                                <option value="query">查询</option>
                                　
                                <option value="add">新增</option>
                                <option value="delete">删除</option>
                                <option value="importFun">导入</option>
                            </select>
                        </td>
                        <!--   <th class="form_head">页面风格：</th>
                           <td class="">
                               <select class="input-block-level" name="styleType">
                                   <option value="">不生成页面</option>
                                   <option value="style3">增删改</option>
                                   <option value="style1">多面板</option>
                                   <option value="style0">工单流程</option>
                               </select>
                             <span class="add-on iconfont icon-fenggepeizhi"></span>
                           </td>-->
                        <!--      <th class="form_head">菜单选择：</th>
                              <td class="">
                                  <button type="button" class="input-block-level" style="cursor: pointer ;border: hidden"
                                          name="" id="menu-choose">
                                      <label id="menuNmae"></label>
                                      <i class="fa fa-compass" style="float: right" aria-hidden="true"></i>
                                  </button>
                              </td>-->
                    </tr>
                    <tr>
                        <th class="form_head">是否需要生成路径：</th>
                        <td class="">
                            <select class="input-block-level" id="isFilePath" name="isFilePath">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                                n>
                            </select>
                        </td>
                        <th class="form_head">Lombock插件：</th>
                        <td class="">
                            <select class="input-block-level" id="isLombok" name="isLombok">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                                n>
                            </select>
                        </td>
                        <th class="form_head">swagger</th>
                        <td class="">
                            <select class="input-block-level" id="swagger" name="swagger">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                                n>
                            </select>
                        </td>
                        <th class="form_head">作者：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="author">
                            <span class="add-on iconfont icon-zuozhe"></span>
                        </td>
                        <!-- <th class="form_head">方法：</th>
                         <td class="">
                             <select id="select" name="select" class="selectpicker input-block-level" multiple data-live-search="true" data-actions-box="true">　　
                                 <option value="mvc">MVC</option>　　
                                 <option value="query">查询</option>　
                                 <option value="add">新增</option>
                                 <option value="delete">删除</option>
                                 <option value="importFun">导入</option>
                             </select>
                         </td>
                         <th class="form_head">数据库类型：</th>
                         <td class="">
                             <select class="input-block-level" name="dbType">
                                 <option value="">==选择==</option>
                                 <option value="Oracle">Oracle</option>
                                 <option value="Mysql">Mysql</option>
                                 <option value="SqlServer">SqlServer</option>
                                 <option value="MongoDB">MongoDB</option>
                             </select>
                         </td>
                         <th class="form_head">DB名称：</th>
                         <td class="">
                             <select class="input-block-level" name="dbName">
                                 <option value="">==选择==</option>
                                 <option value="default">默认</option>
                                 <option value="master">主数据库</option>
                                 <option value="slave">从数据库</option>
                             </select>
                         </td>
                         <th class="form_head">持久层框架：</th>
                         <td class="">
                             <select class="input-block-level" name="OrmType">
                                 <option value="">==选择==</option>
                                 <option value="default">Spring JPA</option>
                                 <option value="Mybatis">Mybatis</option>
                                 <option value="springTemplate">springTemplate</option>
                             </select>
                         </td>-->
                    </tr>
                    <tr>
                        <th class="form_head">增加附件：</th>
                        <td class="">
                            <input type="checkbox" class="input-block-level" name="enableAttach">
                        </td>

                        <th class="form_head">增加工作流：</th>
                        <td class="">
                            <input type="checkbox" class="input-block-level" name="enableWorkflow">
                        </td>
                    </tr>
                </table>
                <input type="hidden" name="dbName" value="default">
                <input type="hidden" name="menuId">
            </form>
            <div class="clear" style="margin-bottom:2px;"></div>
            <div class="mytable_button_div" id="mytable_button_div">
                <ul class="mytable_button">
                    <li id="queryBtn"><i class="iconfont icon-jiexicanshu"></i><span>解析</span></li>
                    <li id="editBtn"><i class="iconfont icon-weibiaoti46"></i><span>生成</span></li>
                    <li id="allSelectBtn"><i class="iconfont icon-total_selection"></i><span>全选</span></li>
                    <li id="defaultBtn"><i class="iconfont icon-moren1"></i><span>默认</span></li>
                </ul>
            </div>
            <div id="mytable" class="x-grid">
                <table class="ftable x-table-head">

                </table>
                <div class="mycontent x-grid-content">
                    <input type="text"  name="entityName"  >
                    <input type="text"  name="tableComments" >
                    <table class="ftable x-table-body new_tab" id="mytable-content">
                        <thead>
                        <tr>
                            <td>字段</td>
                            <td>名称</td>
                            <td>描述</td>
                            <td>等于=</td>
                            <td>不等!=</td>
                            <td>大于>=</td>
                            <td>小于<=</td>
                            <td>like</td>
                            <td>not like</td>
                            <td>in</td>
                            <td>not in</td>
                            <td>值是否为空</td>
                            <td>是否排序</td>
                       <!--     <td>数据字典</td>-->
                        </tr>
                        </thead>
                        <tbody id="grid">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function setSizes() {
        var $el = $('.mycontent');
        var bottom = $(window).height() - $('#queryForm').outerHeight(true) - $('.mytable_button_div').outerHeight(true) - 20;
        $el.css({'height': '' + bottom + 'px'});
    }

    $(document).ready(function () {
        $('.selectpicker').selectpicker({
            'selectedText': 'cat'
        });
        setSizes();
        $("#queryBtn").click(function () {
            debugger;
            var msg;
            /*          var url = $('input[name="url"]').val();
                      var userName = $('input[name="userName"]').val();
                      var passWord = $('input[name="passWord"]').val();*/
            var url = "120.27.144.145:1521:ORCL";
            var userName = "supervision";
            var passWord = "lq_supervision";
            var tableName = $('input[name="tableName"]').val();
            var dataSourceType=$('#dataSourceType option:selected') .val();//选中的值
            var data = {
                url: url,
                userName: userName,
                passWord: passWord,
                tableName: tableName,
                dataSourceType:dataSourceType
            }
            $.ajax({
                url: "http://127.0.0.1:8080/generator/getTableInfo",
                type: "POST",
                dataType: "JSON",
                cache: false,  //不缓存
                async: false,  //同步操作，否者局部变量后变化
                data: data,
                success: function (result, textStatus, jqXHR) {
                    var data = result.data.cloumns;
                    $('#mytable-content tbody').html("");
                    $('input[name="tableComments"]').val(result.data.tableComments);
                    $('input[name="entityName"]').val(result.data.entityName);
                    for (var i = 0; i < data.length; i++) {
                        item = "<tr><td>" + data[i].columnName + "</td><td>" + data[i].fieldName + "</td>" +
                            "<td>"+ data[i].comment+"</td>" +
                            "<td>"+ data[i].comment+"</td>" +
                            "<td>"+ data[i].comment+"</td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='eq'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='ne'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='ge'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='le'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='like'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='nlike'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='in'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='nin'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='isnull'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='sort'></td>" +
                           /* "<td class='x-table-td'><input type='text' name='dictDefined' style='border-style: none;' ></td>" +*/
                            "</tr>";
                        $('#mytable-content tbody').append(item);
                    }
                    $("#mytable-content tr:odd").addClass("ftr1");
                    $("#mytable-content tr:even").addClass("ftr2");
                    //鼠标移动到行变色
                    $("#mytable-content tr").hover(
                        function () {
                            $(this).addClass("ftr3")
                        },
                        function () {
                            $(this).removeClass("ftr3")
                        }
                    );
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error");
                },
                complete: function (XMLHttpRequest, textStatus) {
                    layer.close(msg);
                },
                beforeSend: function () {
                    msg = layer.msg('努力中加载中...', {
                        icon: 16,
                        shade: [0.5, '#f5f5f5'],
                        scrollbar: false,
                        offset: '0px',
                        time: 0
                    });
                }
            });

        });

        $("#editBtn").click(function () {
            var obj = document.getElementsByName('eq');
            var demand = '';
 /*           for (var i = 0; i < obj.length; i++) {
                if (obj[i].checked) {
                    demand += obj[i].name + ',';//如果选中，将value添加到变量s中
                }
            }*/
            alert(demand);
            var tab=document.getElementById("grid");
            var trList = $("#mytable-content").children("tbody").children("tr");
            var paramsArr = new Array();
            for (var i=0;i<trList.length;i++){
                params = {};
                var tdArr = trList.eq(i).find("td");
                var columnName = tdArr.eq(0).text();//
                var fieldName = tdArr.eq(1).text();//
                var comment = tdArr.eq(2).text();//  comment
                var eq = tdArr.eq(3).find('input').is(':checked')==true?'eq':null;//是否起用
                var ne = tdArr.eq(4).find('input').is(':checked')==true?'ne':null;//是否起用
                var ge = tdArr.eq(5).find('input').is(':checked')==true?'ge':null;//是否起用
                var le = tdArr.eq(6).find('input').is(':checked')==true?'le':null;//是否起用
                var like = tdArr.eq(7).find('input').is(':checked')==true?'like':null;//是否起用
                var notLike = tdArr.eq(8).find('input').is(':checked')==true?'notLike':null;//是否起用
                var In = tdArr.eq(9).find('input').is(':checked')==true?'in':null;//是否起用
                var notIn = tdArr.eq(10).find('input').is(':checked')==true?'notIn':null;//是否起用
                var isNull = tdArr.eq(11).find('input').is(':checked')==true?'isNull':null;//是否起用
                var sort = tdArr.eq(12).find('input').is(':checked')==true?'sort':null;//是否起用
                var condition = new Array();
                condition.push(eq,ne,ge,le,like,notLike,In,notIn,isNull,sort);
                params.columnName=columnName;
                params.fieldName=fieldName;
                params.comment=comment;
                params.ruleCondition=condition;
                paramsArr.push(params);
            }
            var msg;
            var packageName = $('input[name="packageName"]').val();
            var isFilePath =  $('#isFilePath option:selected') .val();
            var isLombok = $('#isLombok option:selected') .val();
            var ormType=$('#ormType option:selected') .val();//选中的值
            var author = $('input[name="author"]').val();
            var tableName = $('input[name="tableName"]').val();
            var entityName = $('input[name="entityName"]').val();
            var tableComments = $('input[name="tableComments"]').val();

            var url = "120.27.144.145:1521:ORCL";
            var userName = "supervision";
            var passWord = "lq_supervision";
            var tableName = $('input[name="tableName"]').val();
            var dataSourceType=$('#dataSourceType option:selected') .val();//选中的值
            var data = {
                "url": url,
                "userName": userName,
                "passWord": passWord,
                "tableName": tableName,
                "dataSourceType":dataSourceType,
                "packageName": packageName,
                "isFilePath": isFilePath,
                "isLombok": isLombok,
                "ormType": ormType,
                "author": author,
                "table":{
                    "tableName":tableName,
                   "entityName":entityName,
                    "tableComments":tableComments
                }
            }
            $.ajax({
                url: 'http://127.0.0.1:8080/generator/generateCode',
                type: "POST",
                dataType: "JSON",
                cache: false,  //不缓存
                async: false,  //同步操作，否者局部变量后变化
                data : JSON.stringify(data),
                contentType:"application/json; charset=utf-8",
                success: function (data, textStatus, jqXHR) {
                    var data = data.content;

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error");
                },
                complete: function (XMLHttpRequest, textStatus) {
                    layer.close(msg);
                },
                beforeSend: function () {
                    msg = layer.msg('努力中加载中...', {
                        icon: 16,
                        shade: [0.5, '#f5f5f5'],
                        scrollbar: false,
                        offset: '0px',
                        time: 0
                    });
                }
            });

        });
    });


</script>
</html>
