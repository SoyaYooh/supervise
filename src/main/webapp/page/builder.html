<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>项目信息</title>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../js/layer/theme/default/layer.css"/>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-select.min.css"/>
    <script type="text/javascript" src="../js/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="../js/bootstrap/bootstrap.js"></script>
    <script type="text/javascript" src="../js/bootstrap/bootstrap-select.js"></script>
    <script type="text/javascript" src="../js/bootstrap/bootstrap3-typeahead.js"></script>
    <script type="text/javascript" src="../js/layer/layer.js"></script>
    <style>
        .mytable_button_div {
            text-align: right;
            padding-right: 10px;
            padding-top: 4px;
            padding-bottom: 4px;
        }

        .mytable_button {
            padding: 0;
            margin: 0;
            height: 18px;
        }

        .mytable_button li {
            list-style: none;
            margin-left: 20px;
            float: right;
            width: 70px;
            border-left: 1px solid #EEF3FB;
            cursor: pointer;
        }

        .form_pro {
            font-size: 14px;
            color: rgb(35, 20, 32);
            border-collapse: collapse;
            width: 100%;
            border-color: rgb(200, 199, 204);
            margin: 0px;
        }
        .hero-unit{
            background-image: linear-gradient(to right,rgb(0, 76, 82), rgb(11, 171, 169));
        }
        /*新表格样式*/
        .new_tab {
            border-collapse: collapse;

        }

        .new_tab thead tr td {
            background-image: url(../images/new_tab_img.png);
            border: 1px solid #BED5F3;
        }

        .new_tab tr td {
            border: 1px solid #BED5F3;
            color: #565656;
        }

        .new_tab tr:hover {
            background: #bceee3;
        }

        .ftable thead tr td {
            font: bold 13px "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif;
            color: #ffffff;
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
            border-top: 1px solid #ffffff;
            letter-spacing: 2px;
            /* text-transform: uppercase; */
            text-align: center;
            padding: 6px 6px 6px 12px;
            background: rgb(0, 150, 135);
        }

        .ftable tr td {
            border-right: 1px solid #C1DAD7;
            border-bottom: 1px solid #C1DAD7;
            font-size: 13px;
            padding: 6px 6px 6px 12px;
            text-align: center;
        }

        .ftr1 {
            background: #fff;
            color: #797268;
        }

        .ftr2 {
            background: #e9fffa;
            color: #4f6b72;
        }

        /*鼠标移上变换底色*/
        .ftr3 {
            background: #bceee3;
        }

        .fixed {
            position: fixed;
            width: auto;
            z-index: 2;
            border: none;
        }

        .ftable {
            width: 100%;
        }

        .new_tab {
            border-collapse: collapse;
        }
    </style>
<body>
<div class="container-fluid">
    <div style="height: 10px"></div>
    <div class="hero-unit">
        <div>
            <form class="form-search" style="margin-bottom: 0;">
                <table class="form_pro">
                    <tr>
                        <th class="form_head">数据库类型：</th>
                        <td class="input-prepend input-append">
                            <select class="input-block-level" name="dataSourceType" id="dataSourceType" style="width: 155%;">
                                <option value="Oracle">==请选择==</option>
                                <option value="Oracle">Oracle</option>
                                <option value="Mysql">Mysql</option>
                                <option value="SqlServer">SqlServer</option>
                            </select>
                            <span class="add-on iconfont icon-fenggepeizhi"></span>
                        </td>
                    </tr>
                    <tr>
                        <th class="form_head">数据库url：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="url">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">用户名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="userName">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">密码：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="passWord">
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">表名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level typeahead" name="tableName" data-provide="typeahead">
                            <span class="add-on iconfont icon-biaoge"></span>
                        </td>
                    </tr>
                    <tr>
                        <th class="form_head">包名：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="packageName">
                            <span class="add-on iconfont icon-caidan"></span>
                        </td>
                        <th class="form_head">持久层框架：</th>
                    <!--    <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="userName">
                            <span class="add-on iconfont icon-package"></span>
                        </td>-->
                        <td class="input-prepend input-append">
                            <select class="input-block-level" id="ormType" name="ormType" style="width: 150%;">
                                <option value="mybatis-plus">==请选择==</option>
                                <option value="mybatis">Mybatis</option>
                                <option value="mybatis-plus">Mybatis-plus</option>
                                <option value="jpa">Jpa</option>
                            </select>
                            <span class="add-on iconfont icon-package"></span>
                        </td>
                        <th class="form_head">方法：</th>
                        <td class="">
                            <select id="method" name="select" class="selectpicker input-block-level" multiple
                                    data-live-search="true" data-actions-box="true">　　
                                <option value="mvc">MVC</option>
                                <option value="query">查询</option>
                                <option value="add">新增</option>
                                <option value="delete">删除</option>
                                <option value="import">导入</option>
                                <option value="export">导出</option>
                            </select>
                        </td>
                        <th class="form_head">开发框架：</th>
                        <td class="">
                            <select class="input-block-level" name="frameType">
                                <option value="standard">==选择==</option>
                                <option value="standard">标准结构</option>
                                <option value="tree">树结构</option>
                                <option value="original" selected>原始结构</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th class="form_head">是否需要生成路径：</th>
                        <td class="">
                            <select class="input-block-level" id="isFilePath" name="isFilePath">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                                n>
                            </select>
                        </td>
                        <th class="form_head">Lombock插件：</th>
                        <td class="">
                            <select class="input-block-level" id="isLombok" name="isLombok">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                                n>
                            </select>
                        </td>
                        <th class="form_head">swagger</th>
                        <td class="">
                            <select class="input-block-level" id="isSwagger" name="isSwagger">
                                <option value="Y">==选择==</option>
                                <option value="Y">是</option>
                                <option value="N">否</option>
                            </select>
                        </td>
                        <th class="form_head">作者：</th>
                        <td class="input-prepend input-append">
                            <input type="text" class="input-block-level" name="author">
                            <span class="add-on iconfont icon-zuozhe"></span>
                        </td>
                    </tr>
                    <tr>
                        <th class="form_head">增加附件：</th>
                        <td class="">
                            <input type="checkbox" class="input-block-level" name="enableAttach">
                        </td>

                  <!--      <th class="form_head">增加工作流：</th>
                        <td class="">
                            <input type="checkbox" class="input-block-level" name="enableWorkflow">
                        </td>-->
                    </tr>
                </table>
                <input type="hidden" name="dbName" >
                <input type="hidden" name="menuId" style="display: none">
            </form>
            <div class="clear" style="margin-bottom:2px;"></div>
            <div class="mytable_button_div" id="mytable_button_div">
                <ul class="mytable_button" style="color: #ffffff;">
                    <li id="doExport"><i class="iconfont icon-jiexicanshu"></i><span>导出</span></li>
                    <li id="queryBtn"><i class="iconfont icon-jiexicanshu"></i><span>解析</span></li>
                    <li id="editBtn"><i class="iconfont icon-weibiaoti46"></i><span>生成</span></li>
                    <li id="allSelectBtn"><i class="iconfont icon-total_selection"></i><span>全选</span></li>
                    <li id="defaultBtn"><i class="iconfont icon-moren1"></i><span>默认</span></li>
                </ul>
            </div>
            <div id="mytable" class="x-grid">
                <table class="ftable x-table-head">

                </table>
                <div class="mycontent x-grid-content">
                    <input type="text"  name="entityName" style="display: none" >
                    <input type="text"  name="tableComments" style="display: none">
                    <table class="ftable x-table-body new_tab" id="mytable-content">
                        <thead>
                        <tr>
                            <td>字段</td>
                          <!--  <td>名称</td>-->
                            <td>描述</td>
                            <td>等于=</td>
                            <td>不等!=</td>
                            <td>大于>=</td>
                            <td>小于<=</td>
                            <td>like</td>
                            <td>likeRight</td>
                            <td>likeLeft</td>
                            <td>not like</td>
                            <td>为空</td>
                            <td>不为空</td>
                            <td>是否排序</td>
                        </tr>
                        </thead>
                        <tbody id="grid">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    $(document).ready(function () {
        var url = "120.27.144.145:1521:ORCL";
        var userName = "supervision";
        var passWord = "lq_supervision";
        var tableName = $('input[name="tableName"]').val();
        var dataSourceType=$('#dataSourceType option:selected') .val();//选中的值
        var tableComments;
        var entityName;
        $('input[name="tableName"]').typeahead({
            source: function (query, process) {
                return $.ajax({
                    url:  "http://localhost:8080/generator/getAllTableName",
                    type: 'post',
                    data: {
                        url:url,
                        userName:userName,
                        passWord:passWord,
                        dataSourceType:dataSourceType
                    },
                    success: function (result) {
                        return process(result.data);
                    },
                });
            }
        });
        $("#queryBtn").click(function () {
            debugger;
            var msg;
            var tableName = $('input[name="tableName"]').val();
            var dataSourceType=$('#dataSourceType option:selected') .val();//选中的值
            var data = {
                url: url,
                userName: userName,
                passWord: passWord,
                tableName: tableName,
                dataSourceType:dataSourceType
            }
            $.ajax({
                url: "http://localhost:8080/generator/getTableInfo",
                type: "POST",
                dataType: "JSON",
                cache: false,  //不缓存
                async: false,  //同步操作，否者局部变量后变化
                data: data,
                success: function (result, textStatus, jqXHR) {
                    var data = result.data.cloumns;
                    $('#mytable-content tbody').html("");
                    tableComments=result.data.tableComments;
                    entityName=result.data.entityName;
                    tableName=result.data.tableName;
                    for (var i = 0; i < data.length; i++) {
                        item = "<tr><td>" + data[i].columnName + "</td>" +
                            "<td style='display: none'>" + data[i].fieldName + "</td>" +
                            "<td>"+ data[i].comment+"</td>" +
                            "<td style='display: none'>"+ data[i].dataType+"</td>" +
                            "<td style='display: none'>"+ data[i].fieldType+"</td>" +
                            "<td style='display: none'>"+ data[i].isKey+"</td>" +
                            "<td style='display: none'>"+ data[i].notNull+"</td>" +
                            "<td style='display: none'>"+ data[i].jdbcType+"</td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='eq'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='ne'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='ge'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='le'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='like'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='likeRight'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='likeLeft'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='notLike'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='isNull'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='isNotNull'></td>" +
                            "<td class='x-table-td'><input type='checkbox' value='true' name='sort'></td>" +
                           /* "<td class='x-table-td'><input type='text' name='dictDefined' style='border-style: none;' ></td>" +*/
                            "</tr>";
                        $('#mytable-content tbody').append(item);
                    }
                    $("#mytable-content tr:odd").addClass("ftr1");
                    $("#mytable-content tr:even").addClass("ftr2");
                    //鼠标移动到行变色
                    $("#mytable-content tr").hover(
                        function () {
                            $(this).addClass("ftr3")
                        },
                        function () {
                            $(this).removeClass("ftr3")
                        }
                    );
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error");
                },
                complete: function (XMLHttpRequest, textStatus) {
                    layer.close(msg);
                },
                beforeSend: function () {
                    msg = layer.msg('努力中加载中...', {
                        icon: 16,
                        shade: [0.5, '#f5f5f5'],
                        scrollbar: false,
                        offset: '0px',
                        time: 0
                    });
                }
            });

        });

        $("#editBtn").click(function () {
            debugger;
            var trList = $("#mytable-content").children("tbody").children("tr");
            var paramsArr = new Array();
            for (var i=0;i<trList.length;i++){
                params = {};
                var condition = new Array();
                var tdArr = trList.eq(i).find("td");
                var columnName = tdArr.eq(0).text();//
                var fieldName = tdArr.eq(1).text();//
                var comment = tdArr.eq(2).text();//  comment
                var dataType = tdArr.eq(3).text();//  comment
                var fieldType = tdArr.eq(4).text();//  comment
                var isKey=tdArr.eq(5).text();//  comment
                var notNull=tdArr.eq(6).text();//  comment
                var jdbcType= tdArr.eq(7).text();//  comment
                for (var j = 0; j< tdArr.length; j++) {
                    var ip=tdArr.eq(j).find('input');
                    if(ip.is(':checked')==true){
                        condition.push(ip.attr("name"));
                    }
                }
                params.columnName=columnName;
                params.fieldName=fieldName;
                params.comment=comment;
                params.dataType=dataType;
                params.fieldType=fieldType;
                params.rule=condition;
                params.isKey=isKey;
                params.notNull=notNull;
                params.jdbcType=jdbcType;
                paramsArr.push(params);
            }
            var msg;
            var packageName = $('input[name="packageName"]').val();
            var isFilePath =  $('#isFilePath option:selected') .val();
            var isLombok = $('#isLombok option:selected') .val();
            var isSwagger=$('#isSwagger option:selected') .val();
            var method= $('#method').selectpicker('val')!=null?$('#method').selectpicker('val').toString():"";
            var ormType=$('#ormType option:selected') .val();//选中的值
            var author = $('input[name="author"]').val();
            var tableName = $('input[name="tableName"]').val();
            var dataSourceType=$('#dataSourceType option:selected') .val();//选中的值
            var frameType=$('#frameType option:selected') .val();
            var data = {
                "url": url,
                "userName": userName,
                "passWord": passWord,
                "tableName": tableName,
                "dataSourceType":dataSourceType,
                "packageName": packageName,
                "isFilePath": isFilePath,
                "isLombok": isLombok,
                "ormType": ormType,
                "author": author,
                "isSwagger":isSwagger,
                "method":method,
                "frameType":frameType,
                "table":{
                    "tableName":tableName,
                    "entityName":entityName,
                    "tableComments":tableComments,
                    "cloumns":paramsArr
                }
            };
            var  datadd=    JSON.stringify(data);
            $.ajax({
                url: 'http://localhost:8080/generator/generateCode',
                type: "POST",
                dataType: "JSON",
                cache: false,  //不缓存
                async: false,  //同步操作，否者局部变量后变化
                data : JSON.stringify(data),
                contentType:"application/json; charset=utf-8",
                success: function (data, textStatus, jqXHR) {
                    var data = data.content;

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error");
                },
                complete: function (XMLHttpRequest, textStatus) {
                    layer.close(msg);
                },
                beforeSend: function () {
                    msg = layer.msg('努力中加载中...', {
                        icon: 16,
                        shade: [0.5, '#f5f5f5'],
                        scrollbar: false,
                        offset: '0px',
                        time: 0
                    });
                }
            });

        });
        $("#doExport").click(function () {
            debugger;
            var tableName = $('input[name="tableName"]').val();
            window.location.href='http://localhost:8080/generator/doExport?url='+url+'&userName='+userName+'&passWord='+passWord+'&tableName='+tableName+ '&dataSourceType='+dataSourceType;
        });
    });


</script>
</html>
